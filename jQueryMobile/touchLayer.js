var TouchLayer_Controller=function(){var b=[];var c=function(d){return(b[d]!==undefined)};var a={touchstart:"ontouchstart" in document.documentElement?"touchstart":"mousedown",touchmove:"ontouchmove" in document.documentElement?"touchmove":"mousemove",touchend:"ontouchend" in document.documentElement?"touchend":"mouseup"};return{bind:function(g,e,h,d){var f=false;if(!g||!e||!h){return}if(d!==undefined){f=d}if(a[e]!==undefined){g.addEventListener(a[e],h,f)}},unbind:function(e,d,f){if(!e||!d||!f){return}if(a[d]!==undefined){e.removeEventListener(a[d],f)}},fire:function(d,f,e){if(!d||!f){return}e.type=d;if(!c(d)){f(e)}},lock:function(e){if(e.length>0){for(var d=0;d<e.length;d++){if(!b[e[d]]){b.push(e[d])}}}},unlock:function(f){var e=[];if(f.length>0){for(var d=0;d<b.length;d++){if(!f[b[d]]){e.push(b[d])}}b=e}},makeReturnData:function(f,g,d){return{originalEvent:f,target:g,data:d}}}};var TouchLayer_TapController=function(e){if(!e.eventName||!e.el||!e.callback){return}var b=new TouchLayer_Controller(),s=false,c=false,h=400,g=800,l=1000,r=10,o=null,k=null,q=null,p=null,n=false,i=true;if(e.preventDefault!==undefined){i=e.preventDefault}var j=function(w){if(e.eventName==="tap"){var v=b.makeReturnData(w,e.el);b.fire("tap",e.callback,v)}if(w.event){w=w.event}var u=(w.changedTouches?w.changedTouches[0]:w).target;if(!u.disabled&&this.fireClickEvent){var t=document.createEvent("MouseEvent");t.initMouseEvent("click",w.bubbles,w.cancelable,document.defaultView,w.detail,w.screenX,w.screenY,w.clientX,w.clientY,w.ctrlKey,w.altKey,w.shiftKey,w.metaKey,w.metaKey,w.button,w.relatedTarget);t.isSimulated=true;u.dispatchEvent(t)}};var m=function(u){var t=0,v=0;if(u.touches!==undefined){t=u.touches[0].pageX;v=u.touches[0].pageY}else{if(u.pageX&&u.pageY){t=u.pageX;v=u.pageY}}return(Math.abs(t-q)>=r||Math.abs(v-p)>=r)};var d=function(u){if(u.originalEvent){u=u.originalEvent}if(i){u.preventDefault();u.stopPropagation()}if(u.touches!==undefined){q=u.touches[0].pageX;p=u.touches[0].pageY}else{if(u.pageX&&u.pageY){q=u.pageX;p=u.pageY}}n=false;if(e.eventName==="tapstart"){var t=b.makeReturnData(u,e.el);b.fire("tapstart",e.callback,t)}if(e.eventName==="taphold"){k=setTimeout(function(){var v=b.makeReturnData(u,e.el);b.fire("taphold",e.callback,v);k=null},l)}};var f=function(u){if(u.originalEvent){u=u.originalEvent}if(i){u.preventDefault();u.stopPropagation()}if(m(u)&&!n&&((q+p)>0)){if(e.eventName==="tapcancel"){var t=b.makeReturnData(u,e.el);b.fire("tapcancel",e.callback,t)}if(k){clearTimeout(k);k=null}n=true}};var a=function(v){if(v.originalEvent){v=v.originalEvent}if(i){v.preventDefault();v.stopPropagation()}if(!n){j(v);if(o&&v.timeStamp-o<=g){o=null;if(e.eventName==="doubletap"){var t=b.makeReturnData(v,e.el);b.fire("doubletap",e.callback,t)}}else{o=v.timeStamp}if(h&&!c){if(e.eventName==="singletap"){var u=b.makeReturnData(v,e.el);b.fire("singletap",e.callback,u)}c=true;setTimeout(function(){c=false},h)}if(k){clearTimeout(k);k=null}}n=true};b.bind(e.el,"touchstart",d,s);b.bind(e.el,"touchmove",f,s);b.bind(e.el,"touchend",a,s);return{unbind:function(){b.unbind(e.el,"touchstart",d);b.unbind(e.el,"touchmove",f);b.unbind(e.el,"touchend",a)}}};var TouchLayer_DragController=function(h){if(!h.eventName||!h.el||!h.callback){return}var b=new TouchLayer_Controller(),s=false,m=30,r=true,d=true,q=0,f=0,p=0,c=0,n="",j="",o=false,e=false,k=true;if(h.preventDefault!==undefined){k=h.preventDefault}var l=function(t){return((r&&t.absDeltaX>=m)||(d&&t.absDeltaY>=m))};var g=function(t){if(t.originalEvent){t=t.originalEvent}if(k){t.preventDefault();t.stopPropagation()}if(t.touches!==undefined){q=f=t.touches[0].pageX;p=c=t.touches[0].pageY}else{if(t.pageX&&t.pageY){q=f=t.pageX;p=c=t.pageY}}n=j=t.timeStamp;j=t.timeStamp;o=false};var i=function(w){if(q&&p){if(w.originalEvent){w=w.originalEvent}if(k){w.preventDefault();w.stopPropagation()}var v={startX:q,startY:p,prevX:f,prevY:c,direction:null,deltaY:0,deltaX:0,absDeltaY:0,absDeltaX:0,deltaTime:w.timeStamp-n};if(w.touches){v.deltaY=w.touches[0].pageY-p;v.deltaX=w.touches[0].pageX-q}else{if(w.pageX&&w.pageY){v.deltaY=w.pageY-p;v.deltaX=w.pageX-q}}v.direction=(v.deltaY<0)?"up":"down";if(v!==undefined){v.absDeltaY=Math.abs(v.deltaY);v.absDeltaX=Math.abs(v.deltaX);if(!o){if((!w.touches||w.touches.length<3)&&l(v)){o=true;if(h.eventName==="dragstart"){var t=b.makeReturnData(w,h.el,v);b.fire("dragstart",h.callback,t)}}}if(o){var u=null;if(h.eventName==="drag"&&(!w.touches||w.touches.length<2)){u=b.makeReturnData(w,h.el,v);b.fire("drag",h.callback,u)}else{if(h.eventName==="twofingerdrag"&&(w.touches&&w.touches.length==2)){u=b.makeReturnData(w,h.el,v);b.fire("twofingerdrag",h.callback,u)}}if(w.touches){f=w.touches[0].pageX;c=w.touches[0].pageY}else{if(w.pageX&&w.pageY){f=w.pageX;c=w.pageY}}}}}};var a=function(u){if(u.originalEvent){u=u.originalEvent}if(k){u.preventDefault();u.stopPropagation()}if(o){if(h.eventName==="dragend"){var t=b.makeReturnData(u,h.el);b.fire("dragend",h.callback,t)}}o=false;e=false;q=p=null};b.bind(h.el,"touchstart",g,s);
b.bind(h.el,"touchmove",i,s);b.bind(h.el,"touchend",a,s);return{unbind:function(){b.unbind(h.el,"touchstart",g);b.unbind(h.el,"touchmove",i);b.unbind(h.el,"touchend",a)}}};var TouchLayer_SwipeController=function(n){if(!n.eventName||!n.el||!n.callback){return}var m=new TouchLayer_Controller(),b=false,d=null,j=null,h=null,e=105,i=1000,c=false,k=true,g=false;if(n.preventDefault!==undefined){k=n.preventDefault}if(n.swipeVertical!==undefined){g=n.swipeVertical}var f=function(o){if(o.originalEvent){o=o.originalEvent}if(k){o.preventDefault();o.stopPropagation()}if(o.touches){j=o.touches[0].pageX;h=o.touches[0].pageY}else{if(o.pageX&&o.pageY){j=o.pageX;h=o.pageY}}d=o.timeStamp;c=false};var a=function(v){if(j&&h){if(v.originalEvent){v=v.originalEvent}if(k){v.preventDefault();v.stopPropagation()}var r=null,p=null;if(v.touches){p=v.touches[0].pageY-h;r=v.touches[0].pageX-j}else{if(v.pageX&&v.pageY){p=v.pageY-h;r=v.pageX-j}}if(r&&p){var o=Math.abs(p),q=Math.abs(r),s=v.timeStamp-d,t=null,u={};if(s>i){c=true}else{if(!c&&q>e&&q>o){u={direction:(r<0)?"left":"right",distance:q,deltaTime:s,deltaX:r,deltaY:p};if(n.eventName==="swipe"){t=m.makeReturnData(v,n.el,u);m.fire("swipe",n.callback,t);if(k){v.preventDefault();v.stopPropagation()}}c=true}else{if(!c&&g&&o>e&&o>q){u={direction:(p<0)?"up":"down",distance:o,deltaTime:s,deltaX:r,deltaY:p};if(n.eventName==="swipe"){t=m.makeReturnData(v,n.el,u);m.fire("swipe",n.callback,t);if(k){v.preventDefault();v.stopPropagation()}}c=true}}}}}};var l=function(){c=true;j=h=null};m.bind(n.el,"touchstart",f,b);m.bind(n.el,"touchmove",a,b);m.bind(n.el,"touchend",l,b);return{unbind:function(){m.unbind(n.el,"touchstart",f);m.unbind(n.el,"touchmove",a);m.unbind(n.el,"touchend",l)}}};var TouchLayer=function(){var a={"tapstart":TouchLayer_TapController,"tapcancel":TouchLayer_TapController,"tap":TouchLayer_TapController,"doubletap":TouchLayer_TapController,"taphold":TouchLayer_TapController,"singletap":TouchLayer_TapController,"drag":TouchLayer_DragController,"twofingerdrag":TouchLayer_DragController,"dragstart":TouchLayer_DragController,"dragend":TouchLayer_DragController,"swipe":TouchLayer_SwipeController},b=[];return{bind:function(c,e,g,d){if(!c||!e||!g){return}if(!d){d={}}if(a[c]){d.eventName=c;d.el=e;d.callback=g;var f=b.length;b[f]=new a[c](d);return f}},unbind:function(c){if(b[c]!==null){b[c].unbind();b[c]=null}}}};